#include <avr/io.h>
#include <util/delay.h>
#include <avr/interrupt.h>

 int state = 0;
unsigned char doremi[8] = {239, 212, 189, 178, 158, 141, 126, 118};
int note_advanced = 1;

ISR(INT0_vect)
{
    cli();
    _delay_ms(30);

    OCR0 = doremi[state];
    TCCR0 |= (1 << COM00);
    sei();
    EIFR = (1 << INTF0);
    note_advanced = 0;
}

main()
{
    SREG |= 0x80;
    DDRB |= (1 << DDB4);

    DDRD &= ~(1 << DDD0);
    PORTD |= (1 << PD0);

    EICRA = 0x00;

    EIMSK |= (1 << INT0);

    TCCR0 = (1 << WGM01) | (1 << CS02) | (1 << CS00);

    sei();

    while (1)
    {
        if (PIND & (1 << PIND0))
        {
            TCCR0 &= ~(1 << COM00);

            if (note_advanced == 0)
            {
                state++;
                if (state > 7)
                {
                    state = 0;
                }
                note_advanced = 1;
            }
        }
    }
}